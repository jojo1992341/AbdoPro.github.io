/* ════════════════════════════════════════════════════════════════
   AbdoPro — main.css
   
   Responsabilité unique : fondations visuelles de l'application.
   ─────────────────────────────────────────────────────────────
   Contenu (dans l'ordre) :
     1. Reset & Normalisation
     2. Variables CSS (Design System)
     3. Typographie globale
     4. Layout du shell applicatif
     5. Écran de chargement
     6. Conteneur d'écrans
     7. Barre de navigation inférieure
     8. Utilitaires
     9. Accessibilité
    10. Animations de transition entre écrans
   ─────────────────────────────────────────────────────────────
   Ce fichier ne contient AUCUN composant UI (→ components.css)
   ni AUCUNE surcharge de thème (→ themes.css).
   ════════════════════════════════════════════════════════════════ */


/* ──────────────────────────────────────────────────────────────
   1. RESET & NORMALISATION
   Normalise le rendu cross-browser sans framework externe.
   Approche moderne : box-sizing border-box global,
   suppression des marges par défaut, smooth scroll.
   ────────────────────────────────────────────────────────────── */

*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  /* Empêche le zoom non désiré sur les inputs iOS */
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;

  /* Scroll fluide pour les ancres internes */
  scroll-behavior: smooth;

  /* Hauteur réelle du viewport mobile (exclut la barre d'adresse) */
  height: 100%;
}

body {
  min-height: 100%;
  line-height: 1.5;

  /* Rendu typographique optimisé */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;

  /* Empêche le pull-to-refresh natif en mode standalone */
  overscroll-behavior-y: contain;
}

/* Éléments qui héritent naturellement de la font */
input,
button,
textarea,
select {
  font: inherit;
  color: inherit;
}

/* Reset des boutons */
button {
  border: none;
  background: none;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

/* Reset des listes */
ul,
ol {
  list-style: none;
}

/* Images responsives par défaut */
img,
svg {
  display: block;
  max-width: 100%;
  height: auto;
}

/* Supprime les styles par défaut des éléments interactifs */
a {
  color: inherit;
  text-decoration: none;
}

/* Masque le contenu hidden nativement */
[hidden] {
  display: none !important;
}


/* ──────────────────────────────────────────────────────────────
   2. VARIABLES CSS — DESIGN SYSTEM
   
   Source de vérité pour toutes les valeurs visuelles.
   Référencées par main.css, components.css et themes.css.
   
   Le thème sombre est le thème par défaut (défini ici).
   Le thème clair surcharge ces variables dans themes.css.
   ────────────────────────────────────────────────────────────── */

:root {
  /* ── Couleurs de fond ── */
  --bg-primary:     #0a0a0a;
  --bg-secondary:   #1a1a2e;
  --bg-card:        #16213e;
  --bg-input:       #1e2a45;
  --bg-overlay:     rgba(0, 0, 0, 0.6);

  /* ── Couleurs de texte ── */
  --text-primary:   #e0e0e0;
  --text-secondary: #a0a0b0;
  --text-muted:     #6b7280;
  --text-inverse:   #0a0a0a;

  /* ── Couleurs d'accentuation ── */
  --accent-primary:   #6366f1;   /* Indigo — action principale */
  --accent-primary-hover: #818cf8;
  --accent-primary-subtle: rgba(99, 102, 241, 0.15);

  --accent-success:   #22c55e;   /* Vert — série terminée, progression */
  --accent-success-subtle: rgba(34, 197, 94, 0.15);

  --accent-warning:   #f59e0b;   /* Ambre — hypertrophie, attention */
  --accent-warning-subtle: rgba(245, 158, 11, 0.15);

  --accent-danger:    #ef4444;   /* Rouge — impossible, régression */
  --accent-danger-subtle: rgba(239, 68, 68, 0.15);

  --accent-info:      #3b82f6;   /* Bleu — endurance, information */
  --accent-info-subtle: rgba(59, 130, 246, 0.15);

  /* ── Typographie ── */
  --font-main: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
               'Helvetica Neue', Arial, sans-serif;
  --font-mono: 'SF Mono', 'Cascadia Code', 'Consolas', 'Liberation Mono',
               'Courier New', monospace;

  --text-xs:   0.75rem;   /* 12px */
  --text-sm:   0.875rem;  /* 14px */
  --text-base: 1rem;      /* 16px — taille minimum pour éviter le zoom iOS */
  --text-lg:   1.125rem;  /* 18px */
  --text-xl:   1.25rem;   /* 20px */
  --text-2xl:  1.5rem;    /* 24px */
  --text-3xl:  2rem;      /* 32px */
  --text-4xl:  3rem;      /* 48px — timer, chiffres importants */

  --font-normal:    400;
  --font-medium:    500;
  --font-semibold:  600;
  --font-bold:      700;

  /* ── Espacements (échelle de 4px) ── */
  --space-1:   0.25rem;   /* 4px */
  --space-2:   0.5rem;    /* 8px */
  --space-3:   0.75rem;   /* 12px */
  --space-4:   1rem;      /* 16px */
  --space-5:   1.25rem;   /* 20px */
  --space-6:   1.5rem;    /* 24px */
  --space-8:   2rem;      /* 32px */
  --space-10:  2.5rem;    /* 40px */
  --space-12:  3rem;      /* 48px */
  --space-16:  4rem;      /* 64px */

  /* ── Rayons de bordure ── */
  --radius-sm:   8px;
  --radius-md:   12px;
  --radius-lg:   16px;
  --radius-xl:   24px;
  --radius-full: 9999px;

  /* ── Ombres ── */
  --shadow-sm:   0 1px 2px rgba(0, 0, 0, 0.3);
  --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.3),
                 0 2px 4px -2px rgba(0, 0, 0, 0.2);
  --shadow-button: 0 2px 4px rgba(0, 0, 0, 0.2);
  --shadow-lg:   0 10px 15px -3px rgba(0, 0, 0, 0.3),
                 0 4px 6px -4px rgba(0, 0, 0, 0.2);

  /* ── Transitions ── */
  --transition-fast:   150ms ease-out;
  --transition-normal: 300ms ease-out;
  --transition-slow:   500ms ease-out;

  /* ── Z-index (échelle centralisée) ── */
  --z-base:      1;
  --z-card:      10;
  --z-nav:       100;
  --z-overlay:   500;
  --z-modal:     1000;
  --z-loading:   9999;

  /* ── Dimensions fixes ── */
  --nav-height:    64px;
  --tap-min-size:  44px;    /* Taille tactile minimale WCAG */
  --screen-max-width: 428px; /* Largeur max smartphone */

  /* ── Safe areas (encoches iPhone X+) ── */
  --safe-top:    env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left:   env(safe-area-inset-left, 0px);
  --safe-right:  env(safe-area-inset-right, 0px);
}


/* ──────────────────────────────────────────────────────────────
   3. TYPOGRAPHIE GLOBALE
   ────────────────────────────────────────────────────────────── */

body {
  font-family: var(--font-main);
  font-size: var(--text-base);
  font-weight: var(--font-normal);
  color: var(--text-primary);
  background-color: var(--bg-primary);
}

h1, h2, h3, h4 {
  font-weight: var(--font-bold);
  line-height: 1.2;
  letter-spacing: -0.01em;
}

h1 { font-size: var(--text-2xl); }
h2 { font-size: var(--text-xl); }
h3 { font-size: var(--text-lg); }
h4 { font-size: var(--text-base); }

/* Texte monospace pour les chiffres (timer, reps, scores) */
.mono {
  font-family: var(--font-mono);
}

.text-secondary {
  color: var(--text-secondary);
}

.text-muted {
  color: var(--text-muted);
}


/* ──────────────────────────────────────────────────────────────
   4. LAYOUT DU SHELL APPLICATIF
   
   Structure verticale :
   ┌──────────────────┐
   │ screen-container  │ ← flex-grow: 1 (remplit l'espace)
   │                   │
   │                   │
   ├──────────────────┤
   │ bottom-nav (64px) │ ← fixé en bas
   └──────────────────┘
   ────────────────────────────────────────────────────────────── */

#app {
  position: relative;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  min-height: 100dvh; /* Dynamic viewport height (mobile) */
  max-width: var(--screen-max-width);
  margin: 0 auto;
  overflow: hidden;
}


/* ──────────────────────────────────────────────────────────────
   5. ÉCRAN DE CHARGEMENT
   Les styles de base sont inline dans index.html pour le
   premier rendu. Ici on ajoute les détails supplémentaires.
   ────────────────────────────────────────────────────────────── */

.loading-screen {
  z-index: var(--z-loading);
}


/* ──────────────────────────────────────────────────────────────
   6. CONTENEUR D'ÉCRANS
   
   Zone d'injection pour le routeur SPA.
   Chaque écran occupe 100% de cet espace.
   Le padding-bottom réserve l'espace de la barre de nav.
   ────────────────────────────────────────────────────────────── */

.screen-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  overflow-x: hidden;
  padding-top: var(--safe-top);
  /* Espace pour la nav quand elle est visible */
  padding-bottom: calc(var(--nav-height) + var(--safe-bottom));

  /* Scroll natif fluide sur iOS */
  -webkit-overflow-scrolling: touch;
}

/* Quand la nav est masquée (onboarding, session, feedback, test-max) */
.screen-container.no-nav {
  padding-bottom: var(--safe-bottom);
}

/* Conteneur interne de chaque écran (injecté par les screens/*.js) */
.screen {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: var(--space-4);
  padding-left: calc(var(--space-4) + var(--safe-left));
  padding-right: calc(var(--space-4) + var(--safe-right));
  width: 100%;
  animation: screen-enter var(--transition-normal) both;
}

/* Variante pour les écrans nécessitant un centrage vertical */
.screen.centered {
  justify-content: center;
  align-items: center;
  text-align: center;
}

/* Écran plein hauteur sans scroll (onboarding, feedback) */
.screen.fullheight {
  min-height: 100%;
  overflow: hidden;
}

/* En-tête d'écran standardisé */
.screen-header {
  display: flex;
  flex-direction: column;
  gap: var(--space-1);
  margin-bottom: var(--space-6);
}

.screen-header__title {
  font-size: var(--text-2xl);
  font-weight: var(--font-bold);
  color: var(--text-primary);
}

.screen-header__subtitle {
  font-size: var(--text-sm);
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Séparateur visuel entre sections */
.screen-divider {
  width: 100%;
  height: 1px;
  background: var(--bg-secondary);
  margin: var(--space-4) 0;
  border: none;
}


/* ──────────────────────────────────────────────────────────────
   7. BARRE DE NAVIGATION INFÉRIEURE
   ────────────────────────────────────────────────────────────── */

.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  max-width: var(--screen-max-width);
  height: calc(var(--nav-height) + var(--safe-bottom));
  padding-bottom: var(--safe-bottom);
  display: flex;
  align-items: center;
  justify-content: space-around;
  background-color: var(--bg-secondary);
  border-top: 1px solid rgba(255, 255, 255, 0.06);
  z-index: var(--z-nav);
}

.nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-1);
  min-width: var(--tap-min-size);
  min-height: var(--tap-min-size);
  padding: var(--space-2) var(--space-4);
  border-radius: var(--radius-md);
  color: var(--text-muted);
  transition: color var(--transition-fast),
              background-color var(--transition-fast);
}

.nav-item:active {
  background-color: var(--accent-primary-subtle);
}

.nav-item.active {
  color: var(--accent-primary);
}

.nav-icon {
  font-size: var(--text-xl);
  line-height: 1;
}

.nav-label {
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  line-height: 1;
}


/* ──────────────────────────────────────────────────────────────
   8. UTILITAIRES
   Classes réutilisables à responsabilité unique.
   Préfixe intentionnel pour clarté dans le HTML.
   ────────────────────────────────────────────────────────────── */

/* ── Flexbox ── */
.flex          { display: flex; }
.flex-col      { flex-direction: column; }
.flex-center   { align-items: center; justify-content: center; }
.flex-between  { align-items: center; justify-content: space-between; }
.flex-wrap     { flex-wrap: wrap; }
.flex-1        { flex: 1; }
.gap-1         { gap: var(--space-1); }
.gap-2         { gap: var(--space-2); }
.gap-3         { gap: var(--space-3); }
.gap-4         { gap: var(--space-4); }
.gap-6         { gap: var(--space-6); }
.gap-8         { gap: var(--space-8); }

/* ── Texte ── */
.text-center   { text-align: center; }
.text-left     { text-align: left; }
.text-right    { text-align: right; }
.text-xs       { font-size: var(--text-xs); }
.text-sm       { font-size: var(--text-sm); }
.text-lg       { font-size: var(--text-lg); }
.text-xl       { font-size: var(--text-xl); }
.text-2xl      { font-size: var(--text-2xl); }
.text-3xl      { font-size: var(--text-3xl); }
.text-4xl      { font-size: var(--text-4xl); }
.font-medium   { font-weight: var(--font-medium); }
.font-semibold { font-weight: var(--font-semibold); }
.font-bold     { font-weight: var(--font-bold); }

/* ── Espacement ── */
.mt-2  { margin-top: var(--space-2); }
.mt-4  { margin-top: var(--space-4); }
.mt-6  { margin-top: var(--space-6); }
.mt-8  { margin-top: var(--space-8); }
.mb-2  { margin-bottom: var(--space-2); }
.mb-4  { margin-bottom: var(--space-4); }
.mb-6  { margin-bottom: var(--space-6); }
.mb-8  { margin-bottom: var(--space-8); }
.p-2   { padding: var(--space-2); }
.p-3   { padding: var(--space-3); }
.p-4   { padding: var(--space-4); }
.p-6   { padding: var(--space-6); }

/* ── Largeur ── */
.w-full { width: 100%; }

/* ── Couleurs contextuelles ── */
.color-success { color: var(--accent-success); }
.color-warning { color: var(--accent-warning); }
.color-danger  { color: var(--accent-danger); }
.color-info    { color: var(--accent-info); }
.color-primary { color: var(--accent-primary); }

/* ── Visibilité ── */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}


/* ──────────────────────────────────────────────────────────────
   9. ACCESSIBILITÉ
   ────────────────────────────────────────────────────────────── */

/* Focus visible pour navigation clavier uniquement.
   :focus-visible est supporté par tous les navigateurs modernes.
   N'apparaît pas au tap sur mobile. */
:focus-visible {
  outline: 2px solid var(--accent-primary);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
}

/* Supprime le focus ring au clic/tap */
:focus:not(:focus-visible) {
  outline: none;
}

/* Respecte prefers-reduced-motion :
   Désactive toutes les animations et transitions. */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Contraste élevé : renforce les bordures */
@media (prefers-contrast: high) {
  :root {
    --shadow-card: 0 0 0 1px var(--text-secondary);
    --shadow-button: 0 0 0 1px var(--text-secondary);
  }

  .bottom-nav {
    border-top-width: 2px;
  }
}


/* ──────────────────────────────────────────────────────────────
   10. ANIMATIONS DE TRANSITION ENTRE ÉCRANS
   
   Utilisées par le routeur (app.js) lors du changement de route.
   Deux animations :
   - screen-enter : apparition du nouvel écran
   - screen-exit  : disparition de l'écran courant
   ────────────────────────────────────────────────────────────── */

@keyframes screen-enter {
  from {
    opacity: 0;
    transform: translateY(12px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes screen-exit {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-12px);
  }
}

/* Appliqué dynamiquement par app.js lors de la sortie */
.screen-leaving {
  animation: screen-exit var(--transition-normal) both;
}